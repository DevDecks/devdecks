// For Electron's file system dialog prompt
// Docs: https://github.com/electron/electron/blob/master/docs/api/dialog.md
const dialog = require('electron').remote.dialog;
const fs = require('fs');
const dialogOptions: any = {
  filters: [
    {
      name: 'Images',
      extensions: [ 'jpeg', 'jpg', 'gif', 'png' ]
    }
  ]
};

/**
 * Opens up a native file system dialog to allow user to select an image file.
 * Image is saved to plugin state as a base 64 string buffer.
 */
export default function(updateCurrentPlugin: Function) {
  dialog.showOpenDialog(dialogOptions, (filePaths: string[]) => {
    if (!filePaths) return;
    fs.readFile(filePaths[0], (err: any, data: any) => {
      if (err) return;
      const imageBufferString: string = new Buffer(data).toString('base64');
      updateCurrentPlugin({ imageBufferString, width: 355 });
    });
  });
}
